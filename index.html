<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Laundry Bin Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.2/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.2/firebase-database-compat.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --dark-color: #34495e;
            --light-color: #ecf0f1;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color), #4a69bd);
            border-radius: 12px;
            color: white;
            box-shadow: var(--card-shadow);
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            opacity: 0.8;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            transition: transform var(--transition-speed);
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h2 {
            font-size: 1.3rem;
            color: var(--dark-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .card h2 i {
            margin-right: 10px;
            color: var(--primary-color);
        }
        
        .last-laundry {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .last-laundry .date {
            font-size: 2rem;
            color: var(--primary-color);
            font-weight: bold;
            margin: 10px 0;
        }
        
        .last-laundry .days-ago {
            color: var(--dark-color);
            font-size: 1.1rem;
        }
        
        .progress-container {
            margin: 15px 0;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .progress-bar {
            height: 15px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width var(--transition-speed);
        }
        
        .dark-fill {
            background: linear-gradient(90deg, #2c3e50, #4a69bd);
        }
        
        .light-fill {
            background: linear-gradient(90deg, #dfe6e9, #74b9ff);
        }
        
        .overall-fill {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        
        .ratio-container {
            display: flex;
            align-items: stretch;
            height: 40px;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .ratio-dark {
            background: linear-gradient(90deg, #2c3e50, #4a69bd);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: width var(--transition-speed);
        }
        
        .ratio-light {
            background: linear-gradient(90deg, #dfe6e9, #74b9ff);
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: width var(--transition-speed);
        }
        
        .alert {
            background-color: var(--danger-color);
            color: white;
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
            display: none;
            animation: pulse 2s infinite;
        }
        
        .alert h2 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .alert p {
            opacity: 0.9;
        }
        
        .update-info {
            text-align: center;
            margin-top: 20px;
            color: var(--dark-color);
            opacity: 0.7;
            font-size: 0.9rem;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: var(--dark-color);
        }
        
        .loading i {
            animation: spin 1s linear infinite;
            margin-right: 10px;
            color: var(--primary-color);
        }
        
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        .error-message {
            background-color: var(--danger-color);
            color: white;
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            box-shadow: var(--card-shadow);
            display: none;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-tshirt"></i> Smart Laundry Bin Dashboard</h1>
            <p>Real-time monitoring for your smart laundry bin</p>
        </header>
        
        <div id="loading" class="loading">
            <i class="fas fa-spinner"></i> Connecting to your laundry bin...
        </div>
        
        <div id="error-message" class="error-message">
            <h2><i class="fas fa-exclamation-triangle"></i> Connection Error</h2>
            <p>Could not connect to the Smart Laundry Bin system. Please check your connection and reload.</p>
        </div>
        
        <div id="dashboard-content" style="display: none;">
            <div class="dashboard">
                <div class="card">
                    <h2><i class="fas fa-calendar-alt"></i> Last Laundry Date</h2>
                    <div class="last-laundry">
                        <span class="date" id="last-laundry-date">2023-04-08</span>
                        <span class="days-ago" id="days-ago">0 days ago</span>
                    </div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-chart-pie"></i> Bin Occupancy</h2>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Dark/Colored</span>
                            <span id="left-occupancy">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill dark-fill" id="left-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>White/Light</span>
                            <span id="right-occupancy">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill light-fill" id="right-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Overall Fullness</span>
                            <span id="overall-fullness">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill overall-fill" id="overall-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-balance-scale"></i> Dark to Light Ratio</h2>
                    <div class="ratio-container">
                        <div class="ratio-dark" id="ratio-dark" style="width: 50%">
                            <span id="dark-percentage">50%</span>
                        </div>
                        <div class="ratio-light" id="ratio-light" style="width: 50%">
                            <span id="light-percentage">50%</span>
                        </div>
                    </div>
                    <p class="ratio-info">The ratio is calculated based on the occupancy of each bin section.</p>
                </div>
            </div>
            
            <div id="time-to-wash" class="alert">
                <h2><i class="fas fa-exclamation-circle"></i> Time to Wash!</h2>
                <p>Your laundry bin is getting full. Consider doing your laundry soon.</p>
            </div>
            
            <p class="update-info">Last updated: <span id="last-update">Never</span></p>
        </div>
    </div>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
      apiKey: "AIzaSyDw2Y07IYmFYz2IokzHlvirDhhDOG1cloI",
      authDomain: "rpi-laundry-realtime.firebaseapp.com",
      databaseURL: "https://rpi-laundry-realtime-default-rtdb.firebaseio.com",
      projectId: "rpi-laundry-realtime",
      storageBucket: "rpi-laundry-realtime.firebasestorage.app",
      messagingSenderId: "671997705566",
      appId: "1:671997705566:web:1dcfacfbfab2b0a86f23cf"
    };
        
        // Initialize Firebase
        let firebaseInitialized = false;
        
        try {
            firebase.initializeApp(firebaseConfig);
            firebaseInitialized = true;
        } catch (error) {
            console.error("Firebase initialization error:", error);
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error-message').style.display = 'block';
        }
        
        if (firebaseInitialized) {
            const database = firebase.database();
            const laundryRef = database.ref('/');
            
            // Show loading state
            const loading = document.getElementById('loading');
            const errorMessage = document.getElementById('error-message');
            const dashboardContent = document.getElementById('dashboard-content');
            
            // Listen for data updates
            laundryRef.on('value', (snapshot) => {
                // Hide loading, show content
                loading.style.display = 'none';
                dashboardContent.style.display = 'block';
                
                const data = snapshot.val();
                
                if (!data) {
                    errorMessage.style.display = 'block';
                    return;
                }
                
                // Update last laundry date
                const lastLaundryDate = document.getElementById('last-laundry-date');
                const daysAgo = document.getElementById('days-ago');
                
                if (data.lastLaundryDate) {
                    lastLaundryDate.textContent = data.lastLaundryDate;
                    
                    // Calculate days ago
                    const today = new Date();
                    const laundryDate = new Date(data.lastLaundryDate);
                    const diffTime = Math.abs(today - laundryDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    daysAgo.textContent = diffDays + (diffDays === 1 ? ' day ago' : ' days ago');
                }
                
                // Update occupancy data
                const leftOccupancy = data.leftBinOccupancy || 0;
                const rightOccupancy = data.rightBinOccupancy || 0;
                const overallFullness = data.overallFullness || 0;
                
                // Update progress bars and labels
                document.getElementById('left-occupancy').textContent = leftOccupancy.toFixed(1) + '%';
                document.getElementById('left-progress').style.width = leftOccupancy + '%';
                
                document.getElementById('right-occupancy').textContent = rightOccupancy.toFixed(1) + '%';
                document.getElementById('right-progress').style.width = rightOccupancy + '%';
                
                document.getElementById('overall-fullness').textContent = overallFullness.toFixed(1) + '%';
                document.getElementById('overall-progress').style.width = overallFullness + '%';
                
                // Calculate and update dark to light ratio
                const total = leftOccupancy + rightOccupancy;
                let darkRatio = 50;
                let lightRatio = 50;
                
                if (total > 0) {
                    darkRatio = (leftOccupancy / total) * 100;
                    lightRatio = (rightOccupancy / total) * 100;
                }
                
                document.getElementById('ratio-dark').style.width = darkRatio + '%';
                document.getElementById('dark-percentage').textContent = Math.round(darkRatio) + '%';
                
                document.getElementById('ratio-light').style.width = lightRatio + '%';
                document.getElementById('light-percentage').textContent = Math.round(lightRatio) + '%';
                
                // Update time to wash alert
                document.getElementById('time-to-wash').style.display = data.timeToWash ? 'block' : 'none';
                
                // Update last update time
                const lastUpdate = document.getElementById('last-update');
                if (data.lastUpdate) {
                    const updateDate = new Date(data.lastUpdate);
                    lastUpdate.textContent = updateDate.toLocaleString();
                }
            }, (error) => {
                console.error("Database read error:", error);
                loading.style.display = 'none';
                errorMessage.style.display = 'block';
            });
        }
    </script>
</body>
</html>
